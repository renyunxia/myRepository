<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Document</title>
<style type="text/css">
body,
html {
	margin: 0;
	height: 100%;
}
#wrap {
	width: 100%;
	height: 100%;
	position: relative;
}	
header {
	height: 80px;
	padding: 10px 0;
	border-bottom: 1px solid #000;
}
#files {
	position: absolute;
	left: 0;
	width: 100%;
	top: 101px;
	bottom: 0;
	overflow: auto;
	padding: 10px;
	box-sizing: border-box;
}
.add {
	width: 60px;
	height: 60px;
	float: left;
	background: url(img/add.png) no-repeat;
	background-size: cover;
	margin: 15px 0 0 15px;
}
.remove {
	width: 60px;
	height: 60px;
	float: right;
	background: url(img/remove.png) no-repeat;
	background-size: cover;
	margin: 15px 15px 0 0;
}
.file {
	width: 80px;
	height: 90px;
	padding: 10px;
	border: 1px solid rgba(0, 0, 0, 0);
	position: relative;
	float: left;
	margin: 10px;
}
.fileActive {
	border-color: rgba(8, 247, 205, 1);
	background: rgba(8, 247, 205, .1);
}
.file .ico {
	margin: 10px auto 0;
	width: 60px;
	height: 60px;
	background: url(img/file.png) no-repeat;
	background-size: cover;
}
.file .check {
	position: absolute;
	left: 0;
	top: 0;
	display: none;
}
.fileActive .check {
	display: block;

}
.file span {
	display: block;
	font: 12px/20px "宋体",Arial;
	text-align: center;
	white-space: nowrap;
	text-overflow: ellipsis;
	overflow: hidden;
}
.file .text {
	position: absolute;
	left: 10px;
	top: 80px;
	width: 80px;
	height: 20px;
	box-sizing: border-box;
	padding: 1px;
	display: none;
}
</style>
</head>
<body>
<section id="wrap">
	<header>
		<a href="javascript:;" class="add"></a>
		<a href="javascript:;" class="remove"></a>
	</header>
	<div id="files">
		<!--<div class="file">
			<div class="ico"></div>
			<input type="checkbox" class="check">
			<span>新建文件夹</span>
			<input type="text" class="text" >
		</div>
		<div class="file">
			<div class="ico"></div>
			<input type="checkbox" class="check">
			<span>新建文件夹</span>
			<input type="text" class="text" >
		</div>
		<div class="file">
			<div class="ico"></div>
			<input type="checkbox" class="check">
			<span>新建文件夹</span>
			<input type="text" class="text" >
		</div>-->
	</div>
</section>	
<script type="text/javascript">
(function(){
	var addBtn = document.querySelector('.add'); // 获取添加按钮
	var removeBtn = document.querySelector('.remove');
	// 获取删除按钮
	var files = document.querySelector('#files');
	// 获取 所有文件夹的父级
	addBtn.onclick = function(){
		var file = document.createElement("div"); //创建文件夹
		var ico = document.createElement("div"); //创建文件夹图标
		var check = document.createElement("input"); //创建文件夹的选中按钮
		var span = document.createElement("span"); //创建文件夹的名字
		var text = document.createElement("input"); //创建文件夹名字 修改的输入框
		

		file.className = "file";
		ico.className = "ico";
		check.className = "check";
		text.className = "text";
		// 给元素添加对应的className

		check.type = "checkbox";
		text.type = "text";
		// 给input添加类型

		span.innerHTML = getName(); 
		//getName() 获取文件夹的名字  添加给span的内容
		
		
		//鼠标移入文件夹 加上选中的 样式
		file.onmouseover = function(){
			this.className  = "file fileActive";
		}

		//鼠标移出文件夹，判断 如果文件夹没有被勾选，就恢复到没有选中的样式
		file.onmouseout = function(){
			if(!check.checked){
				this.className  = "file";
			}
		}

		//点击文件名字，显示修改名字的输入框，并且把焦点聚焦输入框
		span.onclick = function(){
			text.style.display = "block";
			text.value = span.innerHTML;
			text.focus();
		};

		//修改名字的输入框失去焦点的时候
		text.onblur = function(){
			if(text.value == ""||text.value == span.innerHTML){ //判断如果输入内容为空或者名字没有做修改，就直接隐藏输入框，不修改名字
				text.style.display = "none";
				return;
			}
			if(hasName(text.value)){ //然后判断输入的名字是否是和其他文件夹的名字重复 如果不重复，就隐藏 输入框，修改文件的名字为输入框输入的内容
				text.style.display = "none";
				span.innerHTML = text.value;
			} else {
				//如果名字和其他文件夹重复，聚焦输入框，提示用户重名了
				text.focus(); 
				alert("对不起重名了");
			}
		};

		// 把创建元素添加到父级里边
		file.appendChild(ico);
		file.appendChild(check);
		file.appendChild(span);
		file.appendChild(text);
		files.appendChild(file);
	};
	// 点击删除按钮
	removeBtn.onclick = function(){
		// 循环所有的文件夹
		/* 注意前方有坑：如果通过for循环删除一组内容的时候，请倒序循环*/
		for(var i = files.children.length-1; i >= 0 ; i--){
			//判断文件夹如果被选中了，就删除
			if(files.children[i].className == "file fileActive"){
				files.removeChild(files.children[i]);
			}
		}
	};

	/* hasName 判断这个文件夹名字是否与其他文件夹名字重复 */
	function hasName(newName){
		//循环所有文件夹，如果其中一个名字和我们传入的名字一直，就代表重复，那就返回 false，如果循环执行之后，就代表没有重复返回true
		for(var i = 0; i < files.children.length; i++){
			var name = files.children[i].children[2].innerHTML;
			if(name == newName){
				return false;
			}
		}
		return true;
	}

	// 获取当前文件夹名字
	function getName(){
		var arr = [];//创建数组，用来保存已有文件夹的名字
		for(var i = 0; i < files.children.length; i++){
			//循环所有文件夹的名字
			var name = files.children[i].children[2].innerHTML;
			if((name.substring(0,5) == "新建文件夹"
			&& !isNaN(name.substring(5)))
			|| name == "新建文件夹"
			){
			//判断文件夹的名字 如果 (前5位是 "新建文件夹"，并且后边是数字) 或者(文件夹的名字 就是 "新建文件夹") 
				var nub = parseInt(name.substring(5)) - 1; 
				// 拿到文件夹后边的数字，并且 -1(数组从0开始计数) ,得到的结构，就是 这应该是第几个 文件夹
				nub = isNaN(nub)?0:nub;// 由于第0个文件夹后边没有数字，所以判断如果拿到的数字是 NaN的话就代表这是第0个文件夹
				//console.log(nub);
				arr[nub] = name; //把文件夹 按顺序放入数组对应位
			}
		}
		/*
			循环结束之后，我们就可以得到一个数组，数组是按顺序排列好的 文件夹名字，如果这位没有，就会被空着
			[,"新建文件2",,"新建文件4"]
		*/
		if(!arr[0]){ //判断第0位为空 就直接返回 "新建文件夹"
			return "新建文件夹";
		}
		/* 执行到着 第0位铁定是有东西,开始循环数组*/
		for(var i = 1; i <arr.length; i++){
			if(!arr[i]){//如果数组第几位是,那说明该创建的就是第几位了
				return "新建文件夹" + (i+1); //然后 "新建文件夹" + 第几个
			}
		}
		/* 如果执行到这步，所有没有空着的位数,那就在最后再添加 */
		return "新建文件夹" + (arr.length+1);
	}
})();
</script>
<script>
	function objectFactory(){
		var obj = new Object(),
			Constructor = [].shift.call(arguments);
		obj.__proto__ = Constructor.prototype;
		var ret = Constructor.apply(obj,arguments);
		return ret;
	}
</script>
</body>
</html>