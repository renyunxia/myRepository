<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script type="text/javascript" src="miaov.js"></script>
	<script type="text/javascript">
		var date = new Date();
		//console.log(date);
		var data = [
			{
				name: "这是第一件商品哈哈哈哈哈",
				price: 300,
				img: "img/1.jpg",
				time: "Fri Oct 30 2016 16:50:28"
			},
			{
				name: "这是第二件商品哈哈哈哈哈",
				price: 998,
				img: "img/2.jpg",
				time: "Fri Oct 16 2016 17:50:28"
			},
			{
				name: "这是第三件商品哈哈哈哈哈",
				price: 168,
				img: "img/3.jpg",
				time: "Fri Oct 16 2016 18:50:28"
			},
			{
				name: "这是第四件商品哈哈哈哈哈",
				price: 9.8,
				img: "img/4.jpg",
				time: "Fri Oct 16 2016 19:50:28"
			}
		];
		function toLayout(){
			var list = document.querySelector('.shopList');
			
			var inner = "";
			for(var i = 0; i < data.length; i++){
				inner += '<li><div class="shop"><input type="text" value="'+data[i].time+'"><input type="button" value="确定"><time>剩余00天00时00分00秒</time><img src="'+data[i].img+'"><p class="name">'+data[i].name+'</p><p class="price">抢购价：<span>￥'+data[i].price+'</span></p></div></li>';
			}
			list.innerHTML = inner;
		}
		window.onload = function(){
			toLayout();
			var shopLists = document.querySelectorAll('.shopList .shop');
			var list2 = document.querySelector('#priceList');
			var price = document.querySelector('#price span');
			for(var i = 0; i < shopLists.length; i++){
				shopLists[i].index = i;
				setDate(shopLists[i]);
			}
			function setDate(shop){
				var textTime = shop.querySelector('input[type="text"]');
				var setBtn = shop.querySelector('input[type="button"]');
				var time = shop.querySelector('time');
				var timer = 0;
				var val = textTime.value;
				console.log(textTime,setBtn,time);
				setBtn.onclick = function(){
					if(new Date(textTime.value) == "Invalid Date"){
						alert("请正确输入时间");
						return;
					}
					val = textTime.value;
				};
				lastDate();
				timer = setInterval(lastDate,1000);
				function lastDate(){
					var targetDate = new Date(val);
					var nowDate = new Date();
					var disTime = targetDate.getTime() - nowDate.getTime();
					if(disTime <= 0){
						clearInterval(timer);
						toShake(shop,"left",20,function(){
							mTween(shop,{top:100,opacity:0},500,"easeBoth",function(){
								list2.innerHTML += '<li><p>'+data[shop.index].name+'</p><span>'+data[shop.index].price+'</span><img src="'+data[shop.index].img+'"></li>';
								price.innerHTML = (parseFloat(price.innerHTML) + data[shop.index].price).toFixed(2);
								//toFixed保留几位小数 返回值类型 字符串
							});
						});
					}
					var day = toDB(parseInt(disTime/86400000));
					var hours = toDB(parseInt((disTime%86400000)/3600000));
					var minutes = toDB(parseInt((disTime%3600000)/60000));
					var seconds = toDB(parseInt((disTime%60000)/1000));
					time.innerHTML = "剩余"+day+"天"+hours+"时"+minutes+"分"+seconds+"秒";	
				}
			}
		};
		function toDB(nub){
			return nub < 10? "0"+nub:""+nub;
		}
	</script>
	<style type="text/css">
		ul {
			margin: 0;
			padding: 0;
			list-style: none;
		}
		#wrap{
			width: 880px;
			margin: 30px auto;
		}
		.shopList {
			height: 318px;
		}
		.shopList li{
			width: 220px;
			float: left;
		}
		.shopList .shop{
			position: absolute;
			left: 0;
			top: 0;
			width: 200px;
			padding: 0 10px;
			background: #fff;
		}
		.shopList img {
			display: block;
			width: 200px;
		}
		.shopList time {
			display: block;
		}
		.shopList input {
			margin: 0;
			padding: 0;
			border: none;
			background: none;
		}
		.shopList input[type="text"]{
			width: 160px;
			height: 30px;
			border: 1px solid #000;
		}
		.shopList li{
			height: 318px;
			position: relative;
			background: #ccc;
		}
	</style>
</head>
<body>
<section id="wrap">
	<h2>购买时间</h2>
	<ul class="shopList">
		<!--<li>
			<div class="shop">
				<input type="text" name="">
				<input type="button" value="确定">
				<time>剩余00天00时00分00秒</time>
				<img src="img/1.jpg">
				<p class="name"></p>
				<p class="price">抢购价：<span>￥168</span></p>
			</div>
		</li>-->
	</ul>
	<ul id="priceList">
		<!--<li>
			<p></p>
			<span></span>
			<img src="">
		</li>-->	
	</ul>
	<p id="price">总价：<span>00.00</span>元</p>
</section>
</body>
</html>